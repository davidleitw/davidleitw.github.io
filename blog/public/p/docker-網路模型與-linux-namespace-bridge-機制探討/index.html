<!DOCTYPE html>
<html lang="zh-tw" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=44973&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="在 Container 中最重要的一個特性就是資源的隔離，在 Linux 中透過 namespace 提供不同資源的隔離機制，這篇文章會特別探討其中出現最頻繁的 network 的隔離機制，並且透過簡單的實驗來觀察 Docker 的網路模型是怎麼透過 namespace 實現的。\n">
<title>Docker 網路模型與 Linux namespace, bridge 機制探討</title>

<link rel='canonical' href='http://localhost:44973/p/docker-%E7%B6%B2%E8%B7%AF%E6%A8%A1%E5%9E%8B%E8%88%87-linux-namespace-bridge-%E6%A9%9F%E5%88%B6%E6%8E%A2%E8%A8%8E/'>

<link rel="stylesheet" href="/scss/style.min.3aff20547a2add54ab704500b4adb37343ae667930088584e2c52db92ac82950.css"><meta property='og:title' content="Docker 網路模型與 Linux namespace, bridge 機制探討">
<meta property='og:description' content="在 Container 中最重要的一個特性就是資源的隔離，在 Linux 中透過 namespace 提供不同資源的隔離機制，這篇文章會特別探討其中出現最頻繁的 network 的隔離機制，並且透過簡單的實驗來觀察 Docker 的網路模型是怎麼透過 namespace 實現的。\n">
<meta property='og:url' content='http://localhost:44973/p/docker-%E7%B6%B2%E8%B7%AF%E6%A8%A1%E5%9E%8B%E8%88%87-linux-namespace-bridge-%E6%A9%9F%E5%88%B6%E6%8E%A2%E8%A8%8E/'>
<meta property='og:site_name' content='davidLei'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='docker' /><meta property='article:tag' content='container' /><meta property='article:tag' content='linux' /><meta property='article:tag' content='network' /><meta property='article:published_time' content='2022-05-04T00:01:01&#43;08:00'/><meta property='article:modified_time' content='2022-05-04T00:01:01&#43;08:00'/>
<meta name="twitter:title" content="Docker 網路模型與 Linux namespace, bridge 機制探討">
<meta name="twitter:description" content="在 Container 中最重要的一個特性就是資源的隔離，在 Linux 中透過 namespace 提供不同資源的隔離機制，這篇文章會特別探討其中出現最頻繁的 network 的隔離機制，並且透過簡單的實驗來觀察 Docker 的網路模型是怎麼透過 namespace 實現的。\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切換選單">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_db436d519aec9354.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">davidLei</a></h1>
            <h2 class="site-description">Learn. Build. Share.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/davidleitw'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/wei-cheng-lei-2604121b6/'
                        target="_blank"
                        title="LinkedIn"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="2" />
  <line x1="8" y1="11" x2="8" y2="16" />
  <line x1="8" y1="8" x2="8" y2="8.01" />
  <line x1="12" y1="16" x2="12" y2="11" />
  <path d="M16 16v-3a2 2 0 0 0 -4 0" />
</svg>

                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>關於我</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>文章歸檔</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>夜晚模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目錄</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#network-namespace">Network Namespace</a>
      <ol>
        <li><a href="#建立新的-network-namespace">建立新的 network namespace</a></li>
        <li><a href="#執行-cmd-在特定的-network-namespace">執行 cmd 在特定的 network namespace</a></li>
      </ol>
    </li>
    <li><a href="#veth---virtual-ethernet-device">veth - Virtual Ethernet Device</a>
      <ol>
        <li><a href="#建立新的-veth-pair">建立新的 veth Pair</a></li>
        <li><a href="#將-veth-連結到-network-namespace">將 veth 連結到 network namespace</a></li>
        <li><a href="#啟動-veth-並且分配一個私有的-ip">啟動 veth 並且分配一個私有的 ip</a></li>
      </ol>
    </li>
    <li><a href="#用-bridge-串連多個不同的-namespace">用 bridge 串連多個不同的 namespace</a>
      <ol>
        <li><a href="#建立-bridge-device">建立 bridge device</a></li>
      </ol>
    </li>
    <li><a href="#docker-network-drivers">Docker network drivers</a>
      <ol>
        <li><a href="#建立一個新的-container">建立一個新的 container</a></li>
        <li><a href="#兩個-containers-透過預設的-bridge-互連">兩個 containers 透過預設的 bridge 互連</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/docker/" >
                Docker
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/docker-%E7%B6%B2%E8%B7%AF%E6%A8%A1%E5%9E%8B%E8%88%87-linux-namespace-bridge-%E6%A9%9F%E5%88%B6%E6%8E%A2%E8%A8%8E/">Docker 網路模型與 Linux namespace, bridge 機制探討</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published" datetime='2022-05-04T00:01:01&#43;08:00'>2022-05-04</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>在 Container 中最重要的一個特性就是資源的隔離，在 Linux 中透過 namespace 提供不同資源的隔離機制，這篇文章會特別探討其中出現最頻繁的 network 的隔離機制，並且透過簡單的實驗來觀察 Docker 的網路模型是怎麼透過 namespace 實現的。</p>
<h2 id="network-namespace"><a href="#network-namespace" class="header-anchor"></a>Network Namespace
</h2><p>在 command line 操作 network namespace 通常會使用 <code>ip netns</code> 來操作，先引用 <code>ip-netns</code> 的 <a class="link" href="https://man7.org/linux/man-pages/man8/ip-netns.8.html"  target="_blank" rel="noopener"
    >man page</a> 來介紹一下 network namespace 的定義</p>
<blockquote>
<p>A network namespace is logically another copy of the network stack, with its own routes, firewall rules, and network devices.</p>
</blockquote>
<p>也可以查看 <a class="link" href="https://www.man7.org/linux/man-pages/man7/network_namespaces.7.html"  target="_blank" rel="noopener"
    >NETWORK_NAMESPACES(7)</a></p>
<p><img src="https://i.imgur.com/DHg0aoM.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>因為 network namespace 本身隔離了整個 network stack, 所以幾乎所有關於 network 的資源都會被隔離，每個 namespace 內這些資源都是獨立存在的。</p>
<p>如果有牽涉到 <code>fork()</code> 等建立新的 process 的行為，原則上 child process 會繼承 parent 的 network space。</p>
<p>一開始可以用 <code>ip netns help</code> 來查看大概有哪些指令可以使用</p>
<p><img src="https://i.imgur.com/3FdIjWB.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="建立新的-network-namespace"><a href="#%e5%bb%ba%e7%ab%8b%e6%96%b0%e7%9a%84-network-namespace" class="header-anchor"></a>建立新的 network namespace
</h3><p>建立一個新的 network namespace 可以使用 <code>sudo ip netns add</code> 加上想要的 namespace 名稱，建立之後用 <code>ip netns ls</code> 就可以看到多了一個剛剛建立的 network namespace。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ip netns add ns0
</span></span><span class="line"><span class="cl">$ ip netns ls
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 <code>ip netns</code> 建立的 network namespace 會出現在 <code>/var/run/netns</code> 底下。</p>
<p><img src="https://i.imgur.com/9suVUf7.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>在本地端我們常常會使用 <code>ifconfig</code> 或者 <code>ip addr</code> 來檢查一些網路的配置情況，所以 <code>ip netns</code> 工具為了讓我們更方便的操作，提供了 <code>ip netns exec</code> 的子命令讓我們可以在對應的 network namespace 執行命令，我們下面的幾個範例都會使用剛剛建立的 <code>ns0</code> 來操作，先來看看在 <code>ns0</code> 中執行 <code>ifconfig</code> 或者 <code>ip addr</code> 的情況。</p>
<h3 id="執行-cmd-在特定的-network-namespace"><a href="#%e5%9f%b7%e8%a1%8c-cmd-%e5%9c%a8%e7%89%b9%e5%ae%9a%e7%9a%84-network-namespace" class="header-anchor"></a>執行 cmd 在特定的 network namespace
</h3><p><strong>ip netns exec &lt;network namespace name&gt; + cmd</strong></p>
<p><img src="https://i.imgur.com/QSffLmE.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>可以觀察到，新建立的 <code>ns0</code> 目前只有預設的 <code>lo (loopback interface)</code>，這個 <code>lo</code> 也可以說是 <code>localhost</code> 的虛擬網路 interface。</p>
<p>想要了解更多可以參考</p>
<ul>
<li><a class="link" href="https://www.cnblogs.com/hustcat/p/3920940.html"  target="_blank" rel="noopener"
    >這篇文章</a></li>
<li><a class="link" href="https://askubuntu.com/questions/247625/what-is-the-loopback-device-and-how-do-i-use-it"  target="_blank" rel="noopener"
    >What is the loopback device and how do I use it?</a></li>
</ul>
<h2 id="veth---virtual-ethernet-device"><a href="#veth---virtual-ethernet-device" class="header-anchor"></a>veth - Virtual Ethernet Device
</h2><p>Linux 中有 <a class="link" href="https://man7.org/linux/man-pages/man4/veth.4.html"  target="_blank" rel="noopener"
    >veth - Virtual Ethernet Device</a> 的概念， <code>veth</code> 可以拿來建立不同虛擬網路裝置之間的橋樑，讓不同虛擬裝置之間可以連線，像是不同的 network namespace，又或者是 docker container 之間的連線, ovs 內的應用等等，都有使用到 <code>veth</code> 的概念。</p>
<p><code>veth</code> 都是成對出現的，所以很多文章也把它稱為 <code>veth-pair</code>，在後續的實驗中我們也可以觀察到 Docker 彼此之間的 <code>veth-pair</code>。</p>
<p>為了實驗兩個 network namespace 的連線，我們再建立一個 <code>ns1</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ip netns add ns1
</span></span><span class="line"><span class="cl">$ ip netns ls
</span></span><span class="line"><span class="cl">ns1
</span></span><span class="line"><span class="cl">ns0
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="建立新的-veth-pair"><a href="#%e5%bb%ba%e7%ab%8b%e6%96%b0%e7%9a%84-veth-pair" class="header-anchor"></a>建立新的 veth Pair
</h3><p>上面有提到 <code>veth</code> 都是成對出現的，所以在建立的時候也要同時建立兩端，這邊我們將兩端分別取名 <code>vth0</code> 以及 <code>vth1</code> 代表等等要接在 <code>ns0</code> 與 <code>ns1</code> 上面。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ip link add vth0 <span class="nb">type</span> veth peer vth1
</span></span><span class="line"><span class="cl">$ ip link show
</span></span></code></pre></td></tr></table>
</div>
</div><p>接著用 <code>ip link show</code> 就可以看到剛剛建立的 <code>veth pair</code></p>
<p><img src="https://i.imgur.com/KfnBEla.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="將-veth-連結到-network-namespace"><a href="#%e5%b0%87-veth-%e9%80%a3%e7%b5%90%e5%88%b0-network-namespace" class="header-anchor"></a>將 veth 連結到 network namespace
</h3><p>建立好了兩端的 <code>veth</code> 之後我們就需要把它接到對應的 network namespace</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> vth0 netns ns0
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> vth1 netns ns2
</span></span></code></pre></td></tr></table>
</div>
</div><p>這時候我們再使用 <code>ip link show</code> 確認一下</p>
<p><img src="https://i.imgur.com/Xxv9YDk.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>發現剛剛建立的 <code>vth0</code> 與 <code>vth1</code> 不見了，因為我們已經把他們移動到新建立的 network namespace 之中，我們可以在 <code>ns0</code> 與 <code>ns1</code> 中用 <code>ip addr</code> 觀察到。</p>
<p><img src="https://i.imgur.com/FoVEZnV.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="啟動-veth-並且分配一個私有的-ip"><a href="#%e5%95%9f%e5%8b%95-veth-%e4%b8%a6%e4%b8%94%e5%88%86%e9%85%8d%e4%b8%80%e5%80%8b%e7%a7%81%e6%9c%89%e7%9a%84-ip" class="header-anchor"></a>啟動 veth 並且分配一個私有的 ip
</h3><p>光是把 <code>vth0</code>, <code>vth1</code> 連結到 <code>ns0</code>, <code>ns1</code> 還不夠，為了後續 ping 的實驗我們必須在 <code>ns0</code>, <code>ns1</code> 中啟動 <code>veth</code> 並且分配一個私有的 ip 位置。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns0 ip link <span class="nb">set</span> vth0 up
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns0 ip addr add 172.0.0.2/24 dev vth0
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns1 ip link <span class="nb">set</span> vth1 up
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns1 ip addr add 172.0.0.3/24 dev vth1
</span></span></code></pre></td></tr></table>
</div>
</div><p>我們為 <code>vth0</code> 分配了 172.0.0.2/24，<code>vth1</code> 分配了 172.0.0.3/24，我們一樣分別進入 <code>ns0</code>, <code>ns1</code> 用 <code>ip addr</code> 確認他們對應的 <code>veth</code> 是否開啟並且正確的被分配了 ip</p>
<p><img src="https://i.imgur.com/gz0Ro7m.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>經過一系列的操作之後我們現在的網路拓樸如下</p>
<p><img src="https://i.imgur.com/MhsCm9a.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>因為設置的 ip 在同一個網域下，而且也經過 <code>ip addr</code> 確認綁定到 <code>veth</code> 上，現在可以用 ping 指令發現兩個 network namespace 之間可以通了!</p>
<p><img src="https://i.imgur.com/AgY7egp.png"
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="用-bridge-串連多個不同的-namespace"><a href="#%e7%94%a8-bridge-%e4%b8%b2%e9%80%a3%e5%a4%9a%e5%80%8b%e4%b8%8d%e5%90%8c%e7%9a%84-namespace" class="header-anchor"></a>用 bridge 串連多個不同的 namespace
</h2><p>上面的情境是兩個 network namespace 想要互相連結，但真實世界的網路拓樸通常都是多個不同的 device 要互相連結，這時候如果再用 <code>veth</code> 一個一個設置就不切實際，在一般的網路環境我們會想到用 switch 一類的裝置處理，在 Linux 中也可以透過 <code>bridge</code> 的概念，用類似虛擬 switch 的方式解決多個不同 network namespace 互連的場景。</p>
<p>從頭開始，目標是建立 <code>ns0</code>, <code>ns1</code>, <code>ns2</code> 三個 network namespace 並且讓他們可以透過 <code>bridge</code>互相連結。</p>
<p>最後目標的網路拓樸如下圖</p>
<p><img src="https://i.imgur.com/bC0mjXe.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>注意，這次我們有做一點調整，把 <code>veth</code> 連結到 network namespace 之後統一改名成 <code>eth0</code></p>
<h3 id="建立-bridge-device"><a href="#%e5%bb%ba%e7%ab%8b-bridge-device" class="header-anchor"></a>建立 bridge device
</h3><p>先建立一個 <code>bridge device</code> 並且取名為 <code>br0</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ip link add br0 <span class="nb">type</span> bridge
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> br0 up
</span></span></code></pre></td></tr></table>
</div>
</div><p>建立三個 network namespace 以及建立三對 <code>veth-pair</code> 分別對應 <code>ns0</code>, <code>ns1</code>, <code>ns2</code> 連結到 <code>br0</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ip netns add ns0
</span></span><span class="line"><span class="cl">$ sudo ip netns add ns1
</span></span><span class="line"><span class="cl">$ sudo ip netns add ns2
</span></span><span class="line"><span class="cl">$ sudo ip link add <span class="nb">type</span> veth
</span></span><span class="line"><span class="cl">$ sudo ip link add <span class="nb">type</span> veth
</span></span><span class="line"><span class="cl">$ sudo ip link add <span class="nb">type</span> veth
</span></span></code></pre></td></tr></table>
</div>
</div><p>這次換了一種建立方式，直接 <code>ip link add type veth</code>，不用自己取名字，系統會幫你分配好，如下圖所示</p>
<p><img src="https://i.imgur.com/OB3MrnC.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>先處理對接 <code>br0</code> 的部份，把 <code>veth0</code>, <code>veth2</code>, <code>veth4</code> 連接到 <code>br0</code>，一定要記得把他們 set up。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> veth0 up
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> veth0 master br0
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> veth2 up
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> veth2 master br0
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> veth4 up
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> veth4 master br0
</span></span></code></pre></td></tr></table>
</div>
</div><p>接著處理對接到 network namespace 的部份</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># 設置 ns0</span>
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> veth1 netns ns0
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns0 ip link <span class="nb">set</span> veth1 name eth0
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns0 ip addr add 10.0.0.1/24 dev eth0
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns0 ip link <span class="nb">set</span> eth0 up
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 設置 ns1</span>
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> dev veth3 netns ns1
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns1 ip link <span class="nb">set</span> dev veth3 name eth0
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns1 ip addr add 10.0.0.2/24 dev eth0
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns1 ip link <span class="nb">set</span> dev eth0 up
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 設置 ns2</span>
</span></span><span class="line"><span class="cl">$ sudo ip link <span class="nb">set</span> dev veth5 netns ns2
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns2 ip link <span class="nb">set</span> dev veth5 name eth0
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns2 ip addr add 10.0.0.3/24 dev eth0
</span></span><span class="line"><span class="cl">$ sudo ip netns <span class="nb">exec</span> ns2 ip link <span class="nb">set</span> dev eth0 up
</span></span></code></pre></td></tr></table>
</div>
</div><p>設置好之後可以去每個 network namespace 用 <code>ip addr</code> 查看是否設置完成</p>
<p><img src="https://i.imgur.com/HxAIpep.jpg"
	
	
	
	loading="lazy"
	
	
></p>
<p>可以用 ping 測試是否成功</p>
<p><img src="https://i.imgur.com/reV0urc.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>正常來說會發現還是無法成功 ping</p>
<p>這時候針對 <code>br0</code> 改一下配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo iptables -A FORWARD -i br0 -j ACCEPT
</span></span></code></pre></td></tr></table>
</div>
</div><p>接著就可以測試，發現三個 network namespace 可以互通了</p>
<p><img src="https://i.imgur.com/fZYLfQW.png"
	
	
	
	loading="lazy"
	
	
></p>
<h2 id="docker-network-drivers"><a href="#docker-network-drivers" class="header-anchor"></a>Docker network drivers
</h2><p>再來介紹完基礎的 network namespace, veth, bridge 之後我們再來看看 Docker 的網路模型。</p>
<p>Docker 在設計的時候就提供了很多種不同的 Network drivers 可以替換，不同 Network drivers 代表著不同的網路模型，使用 <code>docker</code> 指令建立容器時，可以透過 <code>--network</code> 參數選擇想要的網路模型。</p>
<p>大致上可以分為這幾種</p>
<ul>
<li><code>bridge</code></li>
<li><code>host</code></li>
<li><code>overlay</code></li>
<li><code>ipvlan</code></li>
<li><code>macvlan</code></li>
<li><code>none</code></li>
</ul>
<p>這篇文章主要會介紹 <code>bridge</code> 模式，一方面是因為上面的範例也讓我們對於 Linux 的 bridge 機制有了初步的了解，另一方面是如果不特別選擇的話，Docker 預設的網路模型就是 <code>bridge</code> 模式。</p>
<blockquote>
<p>In terms of networking, a bridge network is a Link Layer device which forwards traffic between network segments. A bridge can be a hardware device or a software device running within a host machine’s kernel.</p>
</blockquote>
<p>在<a class="link" href="https://docs.docker.com/network/bridge/"  target="_blank" rel="noopener"
    >官方文檔</a>中從定義開始介紹，<code>bridge network</code> 專門用在同個網段(Network segmentation) 的流量轉發，<code>bridge</code> 可以是硬體也可以是 kernel 的機制，前文中我們介紹的 bridge 就是 kernel 提供的 software device。</p>
<p>在一開始安裝完 Docker 之後可以用 <code>ip addr</code> 指令看到一個新的 <code>docker0</code> 的裝置，這就是預設 <code>bridge</code> 模式使用的 bridge，每次在建立新的容器的時候，預設情況 Docker 都會建立一個新的 network namespace，並且透過 <code>docker0</code> 來彼此溝通。</p>
<p><img src="https://i.imgur.com/l8FXB2A.png"
	
	
	
	loading="lazy"
	
	
></p>
<blockquote>
<p>在實驗或者本地端執行的時候使用預設的網路模式很方便，但是在正式的環境往往會複雜許多。</p>
</blockquote>
<p>也可以使用 <code>docker network ls</code> 來看到 driver 的 type 是 <code>bridge</code>。</p>
<p><img src="https://i.imgur.com/MJvRh3C.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>想繼續看 <code>bridge</code> 的詳細資料可以使用 <code>docker network inspect bridge</code>，可以看到 <code>bridge</code> 的 <code>subnet</code>, <code>gateway IP</code> 等等更詳細的設定</p>
<p><img src="https://i.imgur.com/LYB4sEG.png"
	
	
	
	loading="lazy"
	
	
></p>
<h3 id="建立一個新的-container"><a href="#%e5%bb%ba%e7%ab%8b%e4%b8%80%e5%80%8b%e6%96%b0%e7%9a%84-container" class="header-anchor"></a>建立一個新的 container
</h3><p>先建立一個 container 來試試預設的網路功能</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo docker run --name nginx_test1 -d -p 8081:80 nginx
</span></span><span class="line"><span class="cl">$ sudo docker ps -a
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 <code>docker ps -a</code> 確定 <code>nginx_test1</code> 有跑起來</p>
<p><img src="https://i.imgur.com/bvwRulh.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>詳細資料可以使用 <code>docker inspect nginx_test1</code> 來查看，注意最下面 <code>Networks</code> 的地方，可以看到剛剛建立的 <code>nginx_test1</code> 連結到預設的 <code>bridge</code>，並且配了 <code>172.17.0.2</code> 的 ip address 給它</p>
<p><img src="https://i.imgur.com/cKlyBb4.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>在建立 <code>nginx_test1</code> 的時候有設定 <code>8081:80</code> 的映射，所以打開瀏覽器訪問 <code>localhost:8081</code> 應該可以看到 <code>nginx</code> 的首頁</p>
<p><img src="https://i.imgur.com/kwOliZn.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>用 <code>curl localhost:8081</code> 也可以獲得正確的 html</p>
<p><img src="https://i.imgur.com/OtdrnLj.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>我們再次確認 <code>bridge</code> 的配置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo docker inspect bridge
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/KELXW9t.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>可以注意到 <code>Containers</code> 的地方多了剛剛建立的 <code>nginx_test1</code> 的資料，代表說 <code>nginx_test1</code> 是透過 <code>bridge</code> 跟外部建立連線的，這也是為什麼剛剛可以訪問 <code>nginx_test1</code> 的原因。</p>
<h3 id="兩個-containers-透過預設的-bridge-互連"><a href="#%e5%85%a9%e5%80%8b-containers-%e9%80%8f%e9%81%8e%e9%a0%90%e8%a8%ad%e7%9a%84-bridge-%e4%ba%92%e9%80%a3" class="header-anchor"></a>兩個 containers 透過預設的 bridge 互連
</h3><p>接著來觀察在預設的網路環境， container 之間是否也可以藉由 <code>bridge</code> 互連，先用 <code>alpine</code> 的 image 建立兩個 container</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo docker run -dit --name a1 alpine ash
</span></span><span class="line"><span class="cl">$ sudo docker run -dit --name a2 alpine ash
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/f97aohR.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>確認 <code>a1</code>, <code>a2</code> 的 ip</p>
<p><img src="https://i.imgur.com/OD0d2PV.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="https://i.imgur.com/jmBZggO.jpg"
	
	
	
	loading="lazy"
	
	
></p>
<p>利用 <code>docker exec</code> 進入 <code>a1</code> 之後 ping <code>a2</code> 還有 <code>8.8.8.8</code> 試試看是否能連通隔壁的 <code>a2</code> 還有實際的網路</p>
<p><img src="https://i.imgur.com/WAnNM09.png"
	
	
	
	loading="lazy"
	
	
></p>
<p><img src="https://i.imgur.com/xqhpuxc.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>因為前面已經介紹過 veth, network namespace 的概念了，所以可以來觀察一下在預設的模式中， docker 是如何把多個 container 連在一起，讓彼此可以連通</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ip addr
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/8DDjgxS.jpg"
	
	
	
	loading="lazy"
	
	
></p>
<p>使用 <code>ip addr</code> 發現多了兩個 veth 開頭的裝置，分別是</p>
<ul>
<li><code>vethd1d03d7@1f5</code></li>
<li><code>veth6e0f94d@if7</code></li>
</ul>
<p><code>veth</code> 總是成對出現，所以這邊應該可以意識到這是 <code>a1</code>, <code>a2</code> 與 <code>docker0</code> 對接的 <code>veth</code>。</p>
<p>接著進入 <code>a1</code>, <code>a2</code> 對應的 <code>veth</code> 裝置</p>
<p><img src="https://i.imgur.com/YG8Ru1b.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>所以這邊可以畫出目前的網路拓樸</p>
<p><img src="https://i.imgur.com/dDqeeAL.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>在預設模式下，每個 container 都可以透過 <code>docker0</code> 互連，也可以對外連線，那如果每個 container 都會建立一個新的 network namespace，使用 <code>ip netns ls</code> 應該可以看到才對</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ ip netns ls
</span></span></code></pre></td></tr></table>
</div>
</div><p>用 <code>ip netns ls</code> 查詢的結果應該會是空的，上面有簡單提到，每個建立的 network namespace 都會在 <code>/var/run/netns</code> 底下建立一個新的文件，但是 docker 特別建立了一個新的資料夾擺放建立 container 之後產生的 network namespace，在 <code>/var/run/docker/netns</code> 底下</p>
<p><img src="https://i.imgur.com/cyh3TVU.png"
	
	
	
	loading="lazy"
	
	
></p>
<h1 id="reference"><a href="#reference" class="header-anchor"></a>reference
</h1><ul>
<li><a class="link" href="https://hackmd.io/@0xff07/network/https%3A%2F%2Fhackmd.io%2F%400xff07%2FSJzOwViYF"  target="_blank" rel="noopener"
    >計算機網路 - Network Namespace</a></li>
<li><a class="link" href="https://cizixs.com/2017/02/10/network-virtualization-network-namespace/"  target="_blank" rel="noopener"
    >Linux 網路虛擬化: network namespace</a></li>
<li><a class="link" href="https://www.cnblogs.com/bakari/p/10443484.html"  target="_blank" rel="noopener"
    >一文搞懂 Linux network namespace</a></li>
<li><a class="link" href="https://segmentfault.com/a/1190000009491002"  target="_blank" rel="noopener"
    >Linux 虛擬網路設備 - bridge</a></li>
<li><a class="link" href="https://azole.medium.com/docker-container-%E5%9F%BA%E7%A4%8E%E5%85%A5%E9%96%80%E7%AF%87-2-c14d8f852ae4"  target="_blank" rel="noopener"
    >Docker Container 基礎入門篇 2</a></li>
<li><a class="link" href="https://www.hwchiu.com/docker-network-model-lab.html"  target="_blank" rel="noopener"
    >Docker 網路入門篇(二) - Bridge 網路模型</a></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/docker/">Docker</a>
        
            <a href="/tags/container/">Container</a>
        
            <a href="/tags/linux/">Linux</a>
        
            <a href="/tags/network/">Network</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        const elementsToRender = [".main-article", ".widget--toc"];

        elementsToRender.forEach(selector => {
            const element = document.querySelector(selector);
            if (element) {
                renderMathInElement(element, {
                    delimiters: [
                        { left: "$$", right: "$$", display: true },
                        { left: "$", right: "$", display: false },
                        { left: "\\(", right: "\\)", display: false },
                        { left: "\\[", right: "\\]", display: true }
                    ],
                    ignoredClasses: ["gist"]
                });
            }
        });
    });
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相關文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/docker-volume-%E7%94%A8%E6%B3%95%E6%95%B4%E7%90%86/">
        
        

        <div class="article-details">
            <h2 class="article-title">docker volume 用法整理</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/bypassing-the-load-balancer-without-regrets-socc-20/">
        
        

        <div class="article-details">
            <h2 class="article-title">Bypassing the Load Balancer Without Regrets - SoCC ’20</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%90%AD%E5%BB%BA%E6%9C%80%E5%B0%8F%E5%8C%96%E7%9A%84-xdp-%E5%AF%A6%E9%A9%97%E7%92%B0%E5%A2%83/">
        
        

        <div class="article-details">
            <h2 class="article-title">搭建最小化的 xdp 實驗環境</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/linux-socket-programming%E4%B8%89-socket-programming-%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E4%BD%8D%E7%BD%AE%E8%BD%89%E6%8F%9B%E5%87%BD%E6%95%B8/">
        
        

        <div class="article-details">
            <h2 class="article-title">linux socket programming(三): socket programming 中常用的位置轉換函數</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/linux-socket-programming%E4%BA%8C-socket-%E4%B8%AD%E7%94%A8%E4%BE%86%E5%AD%98%E6%94%BE%E5%9C%B0%E5%9D%80%E7%9A%84-sockaddr/">
        
        

        <div class="article-details">
            <h2 class="article-title">linux socket programming(二): socket 中用來存放地址的 sockaddr</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="davidleitw/davidleitw.github.io"
    data-repo-id=""
    data-category="Announcements"
    data-category-id=""
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    data-loading=""
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2019 - 
        
        2025 davidlei
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 建立 <br />
        主題 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.33.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 設計
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >
    

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.9d9ec100f0139808512b69b07eb2dd6e66ad251b611d5a98e989bc35f31f6584.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
